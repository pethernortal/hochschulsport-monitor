import requests from bs4 import BeautifulSoup import os import json from datetime import datetime import urllib.parse def send_whatsapp(message): """Sendet WhatsApp-Nachricht Ã¼ber CallMeBot""" phone = os.environ.get('WHATSAPP_PHONE') api_key = os.environ.get('WHATSAPP_API_KEY') if not phone or not api_key: print("âŒ WHATSAPP_PHONE oder WHATSAPP_API_KEY nicht gesetzt!") return False url = f"https://api.callmebot.com/whatsapp.php?phone={phone}&text={urllib.parse.quote(message)}&apikey={api_key}" try: response = requests.get(url) if response.status_code == 200: print(f"âœ… WhatsApp gesendet: {message}") return True else: print(f"âŒ WhatsApp Fehler: {response.status_code}") return False except Exception as e: print(f"âŒ WhatsApp Exception: {e}") return False def check_hochschulsport(): """PrÃ¼ft Hochschulsport-Website auf Ereignisse""" # URL der Hochschulsport-Seite url = "https://www.hochschulsport.uni-freiburg.de/sportprogramm-aktuell" try: response = requests.get(url, timeout=10) response.raise_for_status() html = response.text # Lade vorherigen Status status_file = 'status.json' if os.path.exists(status_file): with open(status_file, 'r', encoding='utf-8') as f: old_status = json.load(f) else: old_status = { 'sommersemester_2026_offen': False, 'gleitschirm_frei': False, 'last_check': None } new_status = old_status.copy() new_status['last_check'] = datetime.now().isoformat() # Event 1: Sommersemester 2026 Anmeldung if 'sommersemester 2026' in html.lower() or 'sose 2026' in html.lower() or 'ss 2026' in html.lower(): if 'anmeldung' in html.lower() and not old_status['sommersemester_2026_offen']: message = "ğŸ‰ HOCHSCHULSPORT ALERT!\n\nâœ… Anmeldung fÃ¼r SOMMERSEMESTER 2026 ist jetzt offen!\n\nğŸ”— https://www.hochschulsport.uni-freiburg.de/sportprogramm-aktuell" send_whatsapp(message) new_status['sommersemester_2026_offen'] = True print("ğŸ¯ Event erkannt: Sommersemester 2026 Anmeldung offen!") # Event 2: Gleitschirmfliegen freie PlÃ¤tze # Versuche die Gleitschirm-Seite direkt zu laden gleitschirm_url = "https://www.hochschulsport.uni-freiburg.de/sportprogramm-aktuell/_Gleitschirmfliegen" try: gleitschirm_response = requests.get(gleitschirm_url, timeout=10) if gleitschirm_response.status_code == 200: gleitschirm_html = gleitschirm_response.text.lower() # Suche nach Indizien fÃ¼r freie PlÃ¤tze has_free_spots = False if ('freie plÃ¤tze' in gleitschirm_html or 'plÃ¤tze frei' in gleitschirm_html or 'noch plÃ¤tze' in gleitschirm_html or 'jetzt anmelden' in gleitschirm_html): # PrÃ¼fe ob NICHT ausgebucht if 'ausgebucht' not in gleitschirm_html and 'warteliste' not in gleitschirm_html: has_free_spots = True if has_free_spots and not old_status['gleitschirm_frei']: message = "ğŸª‚ HOCHSCHULSPORT ALERT!\n\nâœ… FREIE PLÃ„TZE im GLEITSCHIRMFLIEGEN-Kurs!\n\nSchnell anmelden:\nğŸ”— https://www.hochschulsport.uni-freiburg.de/sportprogramm-aktuell/_Gleitschirmfliegen" send_whatsapp(message) new_status['gleitschirm_frei'] = True print("ğŸ¯ Event erkannt: Gleitschirmfliegen hat freie PlÃ¤tze!") elif not has_free_spots and old_status['gleitschirm_frei']: # Status zurÃ¼cksetzen wenn wieder ausgebucht new_status['gleitschirm_frei'] = False print("â„¹ï¸ Gleitschirmfliegen wieder ausgebucht") except Exception as e: print(f"âš ï¸ Gleitschirm-Seite nicht erreichbar: {e}") # Speichere neuen Status with open(status_file, 'w', encoding='utf-8') as f: json.dump(new_status, f, indent=2, ensure_ascii=False) print(f"âœ… Check abgeschlossen: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}") print(f" - Sommersemester 2026: {new_status['sommersemester_2026_offen']}") print(f" - Gleitschirmfliegen frei: {new_status['gleitschirm_frei']}") except Exception as e: print(f"âŒ Fehler beim Abrufen der Website: {e}") # Sende Fehler-Benachrichtigung send_whatsapp(f"âš ï¸ Hochschulsport Monitor Fehler: {str(e)[:100]}") if __name__ == "__main__": print("ğŸš€ Hochschulsport Monitor gestartet") check_hochschulsport() print("âœ… Fertig!")
